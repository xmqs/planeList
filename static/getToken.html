<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <script src="H5/static/js/jquery-3.3.1.min.js" type="text/javascript" charset="utf-8"></script>
</head>

<body style="background-color: #f5f5f5;">
<div class="xiaohu-tit">
    <p>请求报文</p>
    2018年5月9日18:40:36
</div>
<textarea name="params"
          style="width: 100%; height: 130px; border: 1px solid #cd0000;"
          id="params1"></textarea>
<div class="xiaohu-tit">
    <p>accessToken</p>
</div>
<textarea name="accessToken" id="accessToken"
          style="width: 100%; height: 30px; border: 1px solid #cd0000;"
          id="params2"></textarea>
<div class="zjwUI-btnOK" onclick="javascript:getAccessToken()"
     style="margin-top: 3rem;">获取accessToken
</div>

<ul class="zjwUI_form " style="margin-top: 1rem;">
    <li class="base_input" style="border: 1rem;"><span>续命时间/S</span><span>续命时间/S</span>
        <input type="tel" placeholder="请输入续命时间" name="effectiveTime"
               id="effectiveTime" value=""/></li>
    <li class="base_input" style="border: none;"><span>续命次数</span><span>续命次数</span>
        <input type="tel" placeholder="请输入续命次数" name="effectiveCount"
               id="effectiveCount" value=""/></li>
</ul>
<div class="zjwUI-btnOK" onclick="javascript:setRenewal()"
     style="margin-top: 1rem;">续命
</div>
<div class="zjwUI-btnOK" onclick="javascript:checkAccessToken()"
     style="margin-top: 1rem;">校验accessToken是否有效
</div>
<div class="xiaohu-tit">
    <p>用户信息</p>
</div>
<textarea name="userInfo" id="userInfo"
          style="width: 100%; height: 50px; border: 1px solid #cd0000;"
          id="params"></textarea>
<div class="zjwUI-btnOK" onclick="javascript:getUserInfoByToken()"
     style="margin-top: 1rem;">获取用户信息
</div>
<textarea name="accessToken" id="accessToken2"
          style="width: 100%; height: 600px; border: 1px solid #cd0000;"
></textarea>
<div class="zjwUI-btnOK" onclick="javascript:testinfo()"
     style="margin-top: 1rem;">获取用户详细信息
</div>
<textarea name="accessToken" id="accessToken3"
          style="width: 100%; height: 600px; border: 1px solid #cd0000;"
></textarea>
</body>
<script type="text/javascript">
    $(document).ready(function () {

    });
    var test = "";

    function getAccessToken() {
        var params = {
            //"appId" : "mynj_test"
            "appId": "elecPort"
        };
        //调用原生方法
        auth.getAccessToken(JSON.stringify(params));
    }

    //原生回调
    function getAccessTokenCallback(resopnse) {
        var retData = JSON.parse(resopnse);
        $("#accessToken").val(retData.data.accessToken);

    }

    function setRenewal() {
        var params = {
            "accessToken": $('#accessToken').val(),
            "effectiveTime": $('#effectiveTime').val(),
            "effectiveCount": $('#effectiveCount').val(),
        };
        auth.setRenewal(JSON.stringify(params));
    }

    function setRenewalCallback(params) {
        alert(params);
    }

    function checkAccessToken() {
        var params = {
            "accessToken": $('#accessToken').val()
        };
        auth.checkAccessToken(JSON.stringify(params));
    }

    function checkAccessTokenCallback(params) {
        alert(params);
    }

    function getUserInfoByToken() {
        var params = {
            "accessToken": $('#accessToken').val(),
            "appId": "elecPort"
        };
        auth.getUserInfoByToken(JSON.stringify(params));
    }

    function getUserInfoByTokenCallback(params) {
        $('#accessToken2').val(params);
        test = params;
        /* $.ajax({
           url : '/znmhH5/auth/getUserInfo',
           timeout : 15000,
           data : {
             resp : params
           },
           type : 'post',
           dataType : 'json',
           success : function(data) {
             $("#userInfo").val(JSON.stringify(data.data));

           },
           error : function() {
             alert('获取用户信息嗝屁咯');
           },
         });*/
    }

    function testinfo() {
        /*let test2 = {
          data:test.data,
          msg:"操作成功",
          sign:test.sign,
          signType:test.sign_type
        };*/
        test = JSON.parse(test);
        let test2 = {
            msg: "操作成功",
            data: test.data,
            success: "true",
            sign: test.sign,
            signType: "RSA"
        }
        test2 = JSON.stringify(test2);
        $.ajax({
            url: '/eport-server/auth/mynj/getInfo.do',
            data: test2,
            type: 'post',
            dataType: 'json',
            contentType: 'Application/json',
            success: function (data) {

                $("#accessToken3").val(JSON.stringify(data.data));

            },
            error: function (err) {
                alert(JSON.stringify(err));
            },
        });
    }
</script>

</html>
